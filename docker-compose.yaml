services:
  processor:
    build:
      context: .
      dockerfile: docker/Dockerfile
    command: ["python", "-u", "src/processor.py"]
    volumes:
      - /mnt/jetsondata/tesla-alerts:/data
      - /mnt/teslacam:/teslacam:ro
    environment:
      - PYTHONPATH=/app
      - BASE_DIR=/data
      - TESLACAM_DIR=/teslacam/TeslaCam
      - YOLO_CONFIG_DIR=/data/.config
    restart: unless-stopped

  gif_worker:
    build:
      context: .
      dockerfile: docker/Dockerfile
    command: ["python", "-u", "src/gif_worker.py"]
    volumes:
      - /mnt/jetsondata/tesla-alerts:/data
    environment:
      - PYTHONPATH=/app
      - BASE_DIR=/data
    restart: unless-stopped

  web:
    build:
      context: .
      dockerfile: docker/Dockerfile
    command:
      ["uvicorn", "src.ui_app:app", "--host", "0.0.0.0", "--port", "8080"]
    ports:
      - "8080:8080"
    volumes:
      - /mnt/jetsondata/tesla-alerts:/data
    env_file: .env
    environment:
      - BASE_DIR=/data
      - PYTHONPATH=/app
    restart: unless-stopped
